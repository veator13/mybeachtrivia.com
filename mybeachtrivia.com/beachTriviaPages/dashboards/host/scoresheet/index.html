<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  />
  <title>Team Score Calculator</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Inline styles are OK with your current CSP since it only restricts script-src -->
  <style>
    /* Search Bar Styling */
    .search-container {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-left: auto;
    }
    .search-input {
      width: 220px;
      height: 42px;
      padding: 8px 16px;
      background-color: #2a2a2a;
      color: white;
      border: 2px solid #777;
      border-radius: 6px;
      font-size: 16px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }
    .search-input:focus {
      border-color: #00ffcc;
      box-shadow: 0 0 10px rgba(0, 255, 204, 0.4);
      outline: none;
    }
    .search-input::placeholder { color: #888; }

    /* Highlight animation for found teams */
    @keyframes highlight-pulse {
      0% { background-color: rgba(0, 255, 204, 0.1); }
      50% { background-color: rgba(0, 255, 204, 0.3); }
      100% { background-color: rgba(0, 255, 204, 0.1); }
    }
    .highlighted-row { animation: highlight-pulse 1.5s ease-in-out infinite; }

    /* Adjust button container for search bar */
    .button-container {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 20px;
      margin: 25px 20px 15px;
      flex-wrap: wrap;
    }

    /* Responsive design for search container */
    @media (max-width: 1000px) {
      .search-container {
        flex: 1 0 100%;
        margin-top: 15px;
        justify-content: flex-start;
      }
      .search-input {
        width: 100%;
        max-width: 300px;
      }
    }
  </style>

  <!-- Firebase (compat builds) - loaded as external scripts to satisfy CSP (no inline JS). -->
  <script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-auth-compat.js" defer></script>

  <!-- Your initializer must exist at this path; it should call firebase.initializeApp(...)
       and set window.db = firebase.firestore() plus any helpers your app.js expects.
       Keeping it external avoids 'unsafe-inline' requirements. -->
  <script src="/beachTriviaPages/js/firebase-init-compat.js" defer></script>

  <!-- Route guard (external) -->
  <script src="/beachTriviaPages/js/auth-route-guard.v2.js?v=2025-10-14a" defer></script>

  <!-- App logic (classic script). Must rely on window.db created by the init above. -->

<script src="final-neg-guard.js?v=20251025163459" defer></script>
  <script src="app.js?v=20251027154217" defer></script>

  <!-- Small bindings file that only attaches event listeners and search helpers (no globals).
       Create this file alongside index.html to replace inline handlers. -->
</head>
<body>
  <noscript>This app requires JavaScript enabled.</noscript>

  <header>
    <h1>Trivia Scoresheet</h1>
  </header>

  <main>
    <div class="container">
      <div class="button-container">
        <button type="button" id="btnAddTeam">Add Team</button>
        <button type="button" id="btnShowStandings">Standings</button>
        <button type="button" id="btnSubmitScores">Submit Scores</button>

        <div class="search-container">
          <input
            type="text"
            id="teamSearch"
            class="search-input"
            placeholder="Search team..."
            aria-label="Search for a team"
          />
          <button type="button" id="btnSearch">Search</button>
        </div>
      </div>

      <div class="table-wrapper">
        <table id="teamTable" aria-describedby="tableCaption">
          <caption id="tableCaption" class="sr-only">Enter team names and scores for each round and question.</caption>
          <thead>
            <tr class="top_row">
              <th class="sticky-col" rowspan="2">Team Name</th>
              <th colspan="5">Round 1</th>
              <th rowspan="2">R1 Total</th>
              <th colspan="5">Round 2</th>
              <th rowspan="2">R2 Total</th>
              <th rowspan="2">Half Time</th>
              <th rowspan="2">First Half Total</th>
              <th colspan="5">Round 3</th>
              <th rowspan="2">R3 Total</th>
              <th colspan="5">Round 4</th>
              <th rowspan="2">R4 Total</th>
              <th rowspan="2">Final Question</th>
              <th rowspan="2">Second Half Total</th>
              <th class="sticky-col-right" rowspan="2">Final Score</th>
            </tr>
            <tr class="top_row">
              <th>Q1</th><th>Q2</th><th>Q3</th><th>Q4</th><th>Q5</th>
              <th>Q6</th><th>Q7</th><th>Q8</th><th>Q9</th><th>Q10</th>
              <th>Q11</th><th>Q12</th><th>Q13</th><th>Q14</th><th>Q15</th>
              <th>Q16</th><th>Q17</th><th>Q18</th><th>Q19</th><th>Q20</th>
            </tr>
          </thead>
          <tbody>
            <!-- Team rows will be added here by JavaScript -->
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- Modal for Standings -->
  <div
    id="standingsModal"
    class="modal"
    role="dialog"
    aria-modal="true"
    aria-labelledby="standingsTitle"
    hidden
  >
    <div class="modal-content">
      <button
        type="button"
        id="btnCloseModal"
        class="close"
        aria-label="Close standings"
      >&times;</button>
      <h2 id="standingsTitle">Team Standings</h2>
      <ul id="modalRankingList"></ul>
    </div>
  </div>
</body>
</html>
